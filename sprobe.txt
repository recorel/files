import socket
import requests
from urllib3.exceptions import InsecureRequestWarning

TCP_TIMEOUT = 2


def get_banner(ip_address, port):
    try:
        s = socket.socket()
        s.settimeout(TCP_TIMEOUT)
        s.connect((ip_address, port))
        banner = s.recv(1024)
        return banner.decode("utf-8")
    except Exception:
        return


def get_web(system, port):
    try:
        res = requests.get("http://" + system, allow_redirects=False)
        return {"status_code": res.status_code,
                "headers": res.headers,
                "text": res.text,
                "https": False}
    except Exception:
        try:
            requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)
            res = requests.get("https://" + system, allow_redirects=False, verify=False)
            return {"status_code": res.status_code,
                    "headers": res.headers,
                    "text": res.text,
                    "https": True}
        except Exception:
            return


def enumerate(system_port):
    system, port = system_port
    enum_item = {"system": system, "port": port}

    banner = get_banner(system, port)
    if banner:
        enum_item["banner"] = banner

    web_enum = get_web(system, port)
    if web_enum:
        enum_item.update(web_enum)

    return enum_item


def main():
    # systems = {'www.onet.pl': [80, 443]}
    systems = {'127.0.0.23': [80, 22]}
    for s in systems.keys():
        for p in systems[s]:
            print(enumerate((s, p)))


if __name__ == "__main__":
    main()
