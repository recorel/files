$FilterArgs = @{name='WMI1';
                EventNameSpace='root\CimV2';
                QueryLanguage="WQL";
                Query="SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System' AND TargetInstance.SystemUpTime >= 240 AND TargetInstance.SystemUpTime < 325"};
$Filter=New-CimInstance -Namespace root/subscription -ClassName __EventFilter -Property $FilterArgs
 
$ConsumerArgs = @{name='WMI1';
                CommandLineTemplate="c:\scripts\test.exe";}
$Consumer=New-CimInstance -Namespace root/subscription -ClassName CommandLineEventConsumer -Property $ConsumerArgs
 
$FilterToConsumerArgs = @{
Filter = [Ref] $Filter;
Consumer = [Ref] $Consumer;
}
$FilterToConsumerBinding = New-CimInstance -Namespace root/subscription -ClassName __FilterToConsumerBinding -Property $FilterToConsumerArgs




using System;
using System.IO;

namespace HelloWorld
{
    class Hello {

		public static String GetCurrentTimestamp()
		{
			return Convert.ToString((int)DateTime.UtcNow.Subtract(new DateTime(1970, 1, 1)).TotalSeconds);
		}

	
        static void Main(string[] args)
        {
            System.Console.WriteLine(GetCurrentTimestamp());
			
			string path = @"C:\scripts\" + GetCurrentTimestamp();

        
			using (FileStream fs = File.Create(path)){}
		
		
        }
    }
}



